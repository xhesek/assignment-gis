# Overview

Vytvorte webovu aplikaciu, ktora bude na mape zobrazovat banky na Slovensku. Po spusteni aplikacie su pouzivatelovi zobrazene vsetky banky na Slovensku. Pouzivatel je lokalizovany cez webovy prehliadac a su mu zobrazene najblizsie banky v okruhu 20 km od neho. Dalej si pouzivatel vie zobrazit banky podla ich mena alebo oznacit bod na mape a urcit okruh (v km) v akom sa maju banky zobrazit. Takto si vie zobrazit aj najblizsie bankomaty. Dalsou moznostou je, ze si pouzivatel vie najst najblizsie banky od zvoleneho bodu - vie zadat aj meno banky, okruh v km, pocet najblizsich bank. Pouzivatel vie nakreslit na mapu polygon - tvoreny zo 4 oznacenych bodov a zobrazia sa banky z tejto oblasti. Aplikacia zobrazuje aj body zaujmu od zvolenej banky, ako napr. restauracie, kaviarne, verejne toalety, ... ak by pouzivatel musel dlho cakat na vybavovacky v banke


Aplikácia je schopná zobrazovať na mape banky na Slovensku. Po spustení aplikácie sú používateľovi automaticky zobrazené všetky banky na Slovensku. Hlavnú funkcionalitu aplikácie tvoria tieto akcie:

- lokalizovanie používateľa cez webový prehliadač a zobrazenie najbližších bánk v okruhu 20km
- filtrovanie bánk podľa názvu banky
- filtrovanie bánk podľa určeného bodu na mape a zvoleného okruhu v km
- nájdenie bankomatov a bodov záujmu (reštaurácie, bary, verejné toalety, kaviarne) podľa určeného bodu na mape a zvoleného okruhu v km
- nájdenie najbližších bánk (počet si zvolí používateľ) od zvoleného bodu na mape, zvoleného okruhu v km a zvolených názvov bánk
- nájdenie všetkých bánk, ktoré patria do oblasti, ktorú si používateľ vykreslí do mapy

- bol použitý vlastný štýl background mapy vytvorený pomocou platformy Mapbox
- body záujmu sú od seba aj bánk farebne odlíšené 

Screenshot aplikácie po jej spustení:

![Screenshot](screenshot.png)

Aplikácia sa skladá z dvoch základných častí - Backendu a Frontendu. Backend je tvorený webovou aplikáciou napísanou v Java EE.

The application has 2 separate parts, the client which is a [frontend web application](#frontend) using mapbox API and mapbox.js and the [backend application](#backend) written in [Rails](http://rubyonrails.org/), backed by PostGIS. The frontend application communicates with backend using a [REST API](#api).

# Frontend

The frontend application is a static HTML page (`index.html`), which shows a mapbox.js widget. It is displaying hotels, which are mostly in cities, thus the map style is based on the Emerald style. I modified the style to better highlight main sightseeing points, restaurants and bus stops, since they are all important when selecting a hotel. I also highlighted rails tracks to assist in finding a quiet location.

All relevant frontend code is in `application.js` which is referenced from `index.html`. The frontend code is very simple, its only responsibilities are:
- detecting user's location, using the standard [web location API](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/Using_geolocation)
- displaying the sidebar panel with hotel list and filtering controls, driving the user interaction and calling the appropriate backend APIs
- displaying geo features by overlaying the map with a geojson layer, the geojson is provided directly by backend APIs

# Backend

The backend application is written in Ruby on Rails and is responsible for querying geo data, formatting the geojson and data for the sidebar panel.

## Data

Hotel data is coming directly from Open Street Maps. I downloaded an extent covering whole Slovakia (around 1.2GB) and imported it using the `osm2pgsql` tool into the standard OSM schema in WGS 84 with hstore enabled. To speedup the queries I created an index on geometry column (`way`) in all tables. The application follows standard Rails conventions and all queries are placed in models inside `app/models`, mostly in `app/models/hotel.rb`. GeoJSON is generated by using a standard `st_asgeojson` function, however some postprocessing is necessary (in `app/controllers/search_controller.rb`) in order to merge all hotels into a single geojson.

## Api

**Find hotels in proximity to coordinates**

`GET /search?lat=25346&long=46346123`

**Find hotels by name, sorted by proximity and quality**

`GET /search?name=hviezda&lat=25346&long=46346123`

### Response

API calls return json responses with 2 top-level keys, `hotels` and `geojson`. `hotels` contains an array of hotel data for the sidebar, one entry per matched hotel. Hotel attributes are (mostly self-evident):
```
{
  "name": "Modra hviezda",
  "style": "modern", # cuisine style
  "stars": 3,
  "address": "Panska 31"
  "image_url": "/assets/hotels/652.png"
}
```
`geojson` contains a geojson with locations of all matched hotels and style definitions.
